<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Survey Page</title>

    <!-- Latest compiled and minified CSS & JS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

</head>

<body>

    <div class="container">

        <div class="row">
            <div class="col-lg-12">
                <h1>Survey Questions</h1>
            </div>
            <div class="col-lg-12">
                <!-- About You section -->
                <div class="card">
                    <div class="card-header">
                        About You
                    </div>
                    <div class="card-body">
                        <form role="form">
                            <div class="form-group">
                                <label for="reserve-name">Name (Required)</label>
                                <input type="text" class="form-control" id="name">
                            </div>
                            <div class="form-group">
                                <label for="reserve-phone">Link to Photo Image (Required)</label>
                                <input type="text" class="form-control" id="photo">
                            </div>
                        </form>
                    </div>
                </div>
                <!-- Questions section -->
                <div class="card">
                    <div class="card-header">
                        Questions
                    </div>
                    <div class="card-body">
                        <form role="form">
                            <div class="form-group questions">
                            </div>
                            <button type="submit" class="btn btn-primary submit">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <p>
                    <a href="#">API Friends List</a> | <a href="#">GitHub Repo</a>
                </p>
            </div>
        </footer>

    </div>

</body>

</html>

<!-- BELOW CODE IS CRITICAL. IT HANDLES HOW FORM DATA IS SENT TO OUR SERVER -->
<script type="text/javascript">

    var questions = ["I see myself as extraverted, enthusiastic.", "I see myself as critical, quarrelsome.", "I see myself as dependable, self-disciplined.", "I see myself as anxious, easily upset.", "I see myself as open to new experiences, complex.", "I see myself as reserved, quiet.", "I see myself as sympathetic, warm.", "I see myself as disorganized, careless.", "I see myself as calm, emotionally stable.", "I see myself as conventional, uncreative."];

    var answers = [" Strongly Disagree", " Slightly Disagree", " Neither Agree nor Disagree", " Slightly Agree", " Strongly Agree"];

    var scores = [];

    //Loop through the questions & answer choices
    for (i = 0; i < questions.length; i++) {
        //console.log(questions.indexOf(questions[i]));
        $(".questions").append("<h5>Question " + (questions.indexOf(questions[i]) + 1) + "</h5>");
        $(".questions").append("<p>" + questions[i] + "</p>");
        for (j = 0; j < answers.length; j++) {
            //console.log (j+1);
            $(".questions").append('<label><input type="radio" class="radioBtnClass"' + 'name="radioBtn_' + (i + 1) + '") value="' + (answers.indexOf(answers[j]) + 1) + '" >' + answers[j] + '</label><br>');
        }
        $(".questions").append("<br>");
    };

    $(".submit").on("click", function (event) {
        event.preventDefault();
        console.log("button works");
        for (var i = 0; i < questions.length; i++) {
            scores.push(parseInt($("input[name='radioBtn_" + (i + 1) + "']:checked").val()));
        }
        console.log(scores);
        var newFriend = {
            name: $("#name").val().trim(),
            photo: $("#photo").val().trim(),
            scores: scores.reduce((a, b) => a + b, 0)
        };

        console.log(newFriend);

        $.post("/api/friends", newFriend,
      function(data) {

      
        if (data) {
          alert("Yay! You officially joined Friend Finder community!");
        }

       
        else {
          alert("Sorry you couldn't be added to our community. Please try again!");
        }

        // Clear the form when submitting
        $("#name").val("");
        $("#photo").val("");
        for (var i = 0; i < questions.length; i++) {
            $("input[name='radioBtn_" + (i + 1) + "']").attr('checked', false);
        }

      });
    });

</script>